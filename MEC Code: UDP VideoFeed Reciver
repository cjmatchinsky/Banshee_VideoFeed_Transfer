import cv2, socket
import numpy as np
import time
import base64

BUFF_SIZE = 65536
client_socket = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
host_ip = '12.34.56.789'   ## This is the IP of the VPS (Put the real IP of the VPS HERE)
port = 8009                ## Can Be any port that is not being used.
message = "computer2"
client_socket.sendto(message.encode(),(host_ip, port))
fps, st, frames_to_count, cnt = (0, 0, 20, 0)

while True:
    data, addr1 = client_socket.recvfrom(65536) 
    print(data,addr1)
    # Send data to both clients
    data = base64.b64decode(data,' /')
    npdata = np.frombuffer(data,dtype=np.uint8)
    frame = cv2.imdecode(npdata,1)
    time.sleep(.1)
    #cv2.imshow("RECEIVING VIDEO",frame)
    cv2.imwrite("received_fromPI_to_Computer2.jpg", frame)
    time.sleep(.4)

    frame_img = cv2.imread("received_fromPI_to_Computer2.jpg")
    cv2.imshow("RECEIVING VIDEO",frame_img)
    if frame is not None:
        # Save the received frame as a JPEG
        cv2.imwrite("received_frame_TEST.jpg", frame)
    else:
        print('NO save')
    
    key = cv2.waitKey(1) & 0xFF
    if key == ord('q'):
        client_socket.close()
        break



server_socket.close()
